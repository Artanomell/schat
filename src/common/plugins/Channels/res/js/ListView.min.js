!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){function b(){var b=c(this),g=f.settings;return isNaN(b.datetime)||(0===g.cutoff||e(b.datetime)<g.cutoff)&&a(this).html(d(b.datetime)),this}function c(b){if(b=a(b),!b.data("timeago")){b.data("timeago",{datetime:f.datetime(b)});var c=a.trim(b.text());f.settings.localeTitle?b.attr("title",b.data("timeago").datetime.toLocaleString()):!(c.length>0)||f.isTime(b)&&b.attr("title")||b.attr("title",c)}return b.data("timeago")}function d(a){return f.inWords(e(a))}function e(a){return(new Date).getTime()-a.getTime()}a.timeago=function(b){return d(b instanceof Date?b:"string"==typeof b?a.timeago.parse(b):"number"==typeof b?new Date(b):a.timeago.datetime(b))};var f=a.timeago;a.extend(a.timeago,{settings:{refreshMillis:6e4,allowFuture:!1,localeTitle:!1,cutoff:0,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",wordSeparator:" ",numbers:[]}},inWords:function(b){function c(c,e){var f=a.isFunction(c)?c(e,b):c,g=d.numbers&&d.numbers[e]||e;return f.replace(/%d/i,g)}var d=tr("timeago"),e=d.prefixAgo,f=d.suffixAgo;this.settings.allowFuture&&0>b&&(e=d.prefixFromNow,f=d.suffixFromNow);var g=Math.abs(b)/1e3,h=g/60,i=h/60,j=i/24,k=j/365,l=45>g&&c(d.seconds,Math.round(g))||90>g&&c(d.minute,1)||45>h&&c(d.minutes,Math.round(h))||90>h&&c(d.hour,1)||24>i&&c(d.hours,Math.round(i))||42>i&&c(d.day,1)||30>j&&c(d.days,Math.round(j))||45>j&&c(d.month,1)||365>j&&c(d.months,Math.round(j/30))||1.5>k&&c(d.year,1)||c(d.years,Math.round(k)),m=d.wordSeparator||"";return void 0===d.wordSeparator&&(m=" "),a.trim([e,l,f].join(m))},datetime:function(b){return new Date(parseInt(a(b).attr("data-date"),10))},isTime:function(b){return"time"===a(b).get(0).tagName.toLowerCase()}});var g={init:function(){var c=a.proxy(b,this);c();var d=f.settings;d.refreshMillis>0&&(this._timeagoInterval=setInterval(c,d.refreshMillis))},update:function(c){a(this).data("timeago",{datetime:f.parse(c)}),b.apply(this)},updateFromDOM:function(){a(this).data("timeago",{datetime:f.parse(a(this).attr(f.isTime(this)?"datetime":"title"))}),b.apply(this)},dispose:function(){this._timeagoInterval&&(window.clearInterval(this._timeagoInterval),this._timeagoInterval=null)}};a.fn.timeago=function(a,b){var c=a?g[a]:g.init;if(!c)throw new Error("Unknown function name '"+a+"' for timeago");return this.each(function(){c.call(this,b)}),this}}),function(){"use strict";window.schat={net:{},ui:{},utils:{},lang:{},page:""}}(),function(){"use strict";var a=window.schat.utils;a.isFunction=function(a){return"function"==typeof a},a.isArray=Array.isArray||function(a){return"[object Array]"==Object.prototype.toString.call(a)},a.randomId=function(){var a=new Array(16);return uuid.v4(null,a,0),base32.encode(a)},a.format=function(a,b){return a.replace(/{(\d+)}/g,function(a,c){return"undefined"!=typeof b[c]?b[c]:a})}}(),function(){"use strict";function a(a,b,c,d){var e=0,f=0,g=!1;("undefined"==typeof b||null===b)&&(b=2),a=a.toString(),d!==!1&&(a=a.replace(/&/g,"&amp;")),a=a.replace(/</g,"&lt;").replace(/>/g,"&gt;");var h={ENT_NOQUOTES:0,ENT_HTML_QUOTE_SINGLE:1,ENT_HTML_QUOTE_DOUBLE:2,ENT_COMPAT:2,ENT_QUOTES:3,ENT_IGNORE:4};if(0===b&&(g=!0),"number"!=typeof b){for(b=[].concat(b),f=0;f<b.length;f++)0===h[b[f]]?g=!0:h[b[f]]&&(e|=h[b[f]]);b=e}return b&h.ENT_HTML_QUOTE_SINGLE&&(a=a.replace(/'/g,"&#039;")),g||(a=a.replace(/"/g,"&quot;")),a}schat.utils.encode=a}(),function(){"use strict";function a(a,b,c,d){var e=a%10;return 1==e&&(1==a||a>20)?b:e>1&&5>e&&(a>20||10>a)?c:d}function b(a,b){if("timeago"===a){var c=SimpleChat.translate("lang");return e[e.hasOwnProperty(c)?c:"en"]}return SimpleChat.translate(a,b)}function c(a){$('[data-tr="'+a+'"]').html(b(a))}function d(){$("[data-tr]").each(function(){c($(this).attr("data-tr"))})}var e={en:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"<b>%d</b> minutes",hour:"about an hour",hours:"about <b>%d</b> hours",day:"a day",days:"<b>%d</b> days",month:"about a month",months:"<b>%d</b> months",year:"about a year",years:"<b>%d</b> years",wordSeparator:" ",numbers:[]},ru:{prefixAgo:null,prefixFromNow:"через",suffixAgo:"назад",suffixFromNow:null,seconds:"меньше минуты",minute:"минуту",minutes:function(b){return a(b,"<b>%d<b/> минуту","<b>%d</b> минуты","<b>%d</b> минут")},hour:"час",hours:function(b){return a(b,"<b>%d</b> час","<b>%d</b> часа","<b>%d</b> часов")},day:"день",days:function(b){return a(b,"<b>%d</b> день","<b>%d</b> дня","<b>%d</b> дней")},month:"месяц",months:function(b){return a(b,"<b>%d</b> месяц","<b>%d</b> месяца","<b>%d</b> месяцев")},year:"год",years:function(b){return a(b,"<b>%d</b> год","<b>%d</b> года","<b>%d</b> лет")}}};"undefined"!=typeof SimpleChat&&SimpleChat.retranslated.connect(function(){d()}),window.tr=b,window.TR=c,schat.lang.retranslate=d,window.Utils=window.Utils||{},window.Utils.tr=b,window.Utils.TR=c,window.Utils.retranslate=d}(),function(){"use strict";window.schat.ui.main=document.getElementById("main"),window.schat.ui.createElement=function(a,b,c){var d=document.createElement(a);for(var e in b)b.hasOwnProperty(e)&&d.setAttribute(e,b[e]);return"string"==typeof c?d.innerHTML=c:"object"==typeof c&&c.hasOwnProperty("text")&&(d.textContent=c.text),b&&b.hasOwnProperty("data-tr")&&(d.innerHTML=tr(b["data-tr"])),d}}(),function(){"use strict";var a=window.schat.ui.createElement,b=document.getElementById("modal"),c=a("div",{"class":"modal-dialog"}),d=c.appendChild(a("div",{"class":"modal-content"})),e=d.appendChild(a("div",{"class":"modal-header"}));e.appendChild(a("button",{"class":"close","data-dismiss":"modal","aria-hidden":"true"},"&times;"));var f=e.appendChild(a("h4",{"class":"modal-title"})),g=d.appendChild(a("div",{"class":"modal-body"})),h=d.appendChild(a("div",{"class":"modal-footer"}));b.appendChild(c),schat.ui.modal={element:b,header:e,title:f,body:g,footer:h,current:null,dialog:c},$(document).ready(function(){$(b).on("hidden.bs.modal",function(){if(schat.ui.modal.current)try{schat.ui.modal.current.hidden()}catch(a){}f.textContent="",g.textContent="",h.textContent="",h.style.display="block",schat.ui.modal.current=null})}),$(b).on("shown.bs.modal",function(){if(schat.ui.modal.current)try{schat.ui.modal.current.shown()}catch(a){}})}(),function(){"use strict";function a(){schat.ui.main.textContent="",schat.ui.main.setAttribute("class","panel-main"),this.qt="undefined"!=typeof SimpleChat,this.date={index:0,stats:0};var a=b("div",{"class":"panel panel-default panel-rooms"});this.qt||a.appendChild(b("div",{"class":"panel-heading","data-tr":"common-rooms"})),this.rooms=b("div",{"class":"list-group"}),a.appendChild(this.rooms),schat.ui.main.appendChild(a),a=b("div",{"class":"panel panel-default panel-stats"}),a.appendChild(this.qt?b("div",{"class":"panel-heading","data-tr":"common-stats"}):b("div",{"class":"panel-heading"},'<a href="/stats" class="internal" data-tr="common-stats">'+tr("common-stats")+"</a>")),this.stats=a.appendChild(b("div",{"class":"panel-body"})),schat.ui.main.appendChild(a)}var b=schat.ui.createElement;a.prototype.setRooms=function(a){this.rooms.textContent="";for(var c=0;c<a.length;c++){var d=a[c][4];this.rooms.appendChild(b("div",{"class":"list-group-item"},'<span class="badge">'+a[c][2]+"</span>"+(2&d?'<i class="schat-icon schat-icon-pin pull-right"></i>':"")+(4&d?'<i class="schat-icon schat-icon-lock pull-right"></i>':"")+'<h5 class="list-group-item-heading">'+this.toUrl(a[c][0],a[c][1],d)+'</h5><small class="list-group-item-text text-muted">'+(""===a[c][3]?tr("channels-no-title"):schat.utils.encode(a[c][3]))+"</small>"))}},a.prototype.setStats=function(a){a&&(this.stats.innerHTML=schat.utils.format(tr("stats-stats"),[tr("stats-users",a.users[0]),tr("stats-rooms",a.rooms[0]),a.users[1],a.users[2]]),$(".timeago").timeago())},a.prototype.toUrl=function(a,b){return'<a class="internal" href="/talk/'+a+'">'+schat.utils.encode(b)+"</a>"},window.schat.ui.MainWidget=a}(),function(){"use strict";function a(){this.serverName=document.getElementById("server-name"),this.joinName=document.getElementById("join-name"),this.joinBtn=document.getElementById("join"),this.createBtn=document.getElementById("create")}a.prototype.setName=function(a){this.serverName.textContent=a},window.schat.ui.RoomsNavbar=a}(),function(){"use strict";function a(){var a=SimpleChat.channel(SimpleChat.serverId());null!==a&&e.setName.call(e,a.Name),SimpleChat.feed(SimpleChat.serverId(),"list",1),SimpleChat.feed(SimpleChat.serverId(),"stats",1)}function b(a){"list"==a.feed?"body"!=a.type||200!=a.status&&303!=a.status||f.setRooms(a.data.channels):"stats"!=a.feed||"body"!=a.type||200!=a.status&&303!=a.status||f.setStats(a.data)}function c(){e.joinName.setAttribute("placeholder",tr("channels-channel-name")),f.setStats(SimpleChat.feed(SimpleChat.serverId(),"stats",3))}function d(){schat.lang.retranslate(),c(),a(),$(e.joinBtn).on("click.join",function(a){a.preventDefault();var b=e.joinName.value;b.length>=3&&(ChannelsView.join(b),e.joinName.value="")}),$("body").on("click.channel",".nick",function(a){a.preventDefault(),ChannelsView.join($(this).attr("id"))}),$(e.createBtn).on("click.create",function(a){a.preventDefault(),ChannelsView.addRoom()})}schat.ui.MainWidget.prototype.toUrl=function(a,b,c){return'<a href="'+ChannelsView.toUrl(a,b)+'" class="nick color-'+(4&c?"green":"default")+'" id="'+a+'">'+schat.utils.encode(b)+"</a>"};var e=new schat.ui.RoomsNavbar,f=new schat.ui.MainWidget;"undefined"==typeof ChannelsView?window.ChannelsView={join:function(){},create:function(){},toUrl:function(){return"#"}}:(ChannelsView.feed.connect(function(a){b(a)}),ChannelsView.serverRenamed.connect(function(){e.setName.apply(e,arguments)})),"undefined"!=typeof SimpleChat&&(SimpleChat.online.connect(function(){a()}),SimpleChat.retranslated.connect(function(){c()})),$(document).ready(d)}();