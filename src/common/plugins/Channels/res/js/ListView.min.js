var ChannelsList={retranslate:function(){$("#join-name").attr("placeholder",Utils.tr("channels_channel_name"))},online:function(){var a=SimpleChat.channel(SimpleChat.serverId());null!==a&&ChannelsList.setName(a.Name),ChannelsList.get()},get:function(){SimpleChat.feed(SimpleChat.serverId(),FEED_NAME_LIST,1),Loader.spinner.add("loading/channels")},setName:function(a){$("#server-name").text(a)}};ChannelsList.feed={read:function(a){a.feed==FEED_NAME_LIST&&("body"==a.type?ChannelsList.feed.list(a.data,a.status):"reply"==a.type&&"id"==a.path&&CreateWindow.feed(a.data,a.status))},list:function(a,b){if($(".channel-item").remove(),200==b||303==b)for(var c=a.channels,d=$("#channels-list"),e=0;e<c.length;e++){var f=c[e];f.length<4||d.append(ChannelsList.feed.listItem(f))}Loader.spinner.remove("loading/channels")},listItem:function(a){var b=a[3];""==b&&(b='<span data-tr="channels_no_title">'+Utils.tr("channels_no_title")+"</span>");var c=a[4];return'<div class="channel-item"><div class="channel-item-header"><i class="icon-'+(4&c?"secure":"channel")+'"></i>&nbsp;<a href="'+ChannelsView.toUrl(a[0],a[1])+'" class="nick color-'+(4&c?"green":"default")+'" id="'+a[0]+'">'+a[1]+'</a><span class="badge">'+a[2]+(2&c?'</span>&nbsp;<i class="icon-pin"></i>':"")+'</div><div class="channel-item-title">'+b+"</div></div>"}};var CreateWindow={text:null,load:function(a){$("#modal-body").html(a),$("#channel-create [data-tr]").each(function(){Utils.TR($(this).attr("data-tr"))}),Utils.adjustWidth($("#channel-create .control-label"));var b=$("#create-name");b.focus(),$("#create-submit").on("click.create",function(a){a.preventDefault(),CreateWindow.text=b.val().replace(/\s{2,}/g," ").trim();var c=CreateWindow.text;return 0!=c.length?c.length<3?void CreateWindow.setError("channels_bad_name"):void SimpleChat.request(SimpleChat.serverId(),FEED_METHOD_GET,LIST_FEED_ID_REQ,{value:c}):void 0}),b.on("input",function(){CreateWindow.clearError()})},clearError:function(){$("#create-name-row").removeClass("error"),$(".alert").hide()},setError:function(a){var b=$("#create-error");b.text(Utils.tr(a)),b.attr("data-tr",a),$("#create-name-row").addClass("error"),$(".alert").show(),$("#create-name").focus()},feed:function(a,b){"#channel-create".length&&(403==b?(ChannelsView.create(a.value,CreateWindow.text,$("#access-checkbox").is(":checked")),$("#modal").modal("hide")):400==b?CreateWindow.setError("channels_bad_name"):200==b&&CreateWindow.setError("channels_already_exists"))}};Modal.create.create=function(){var a=$("#modal-header h3");a.text(Utils.tr("channels_create_title")),a.attr("data-tr","channels_create_title"),$.ajax({url:"create.html",isLocal:!0,dataType:"html",success:CreateWindow.load})},$(document).ready(function(){Utils.retranslate(),ChannelsList.retranslate(),ChannelsList.online(),Modal.init(),$("#join").on("click.join",function(a){a.preventDefault();var b=$("#join-name"),c=b.val();c.length>=3&&(ChannelsView.join(c),b.val(""))}),$("body").on("click.channel",".nick",function(a){a.preventDefault(),ChannelsView.join($(this).attr("id"))})}),"undefined"!=typeof SimpleChat&&(SimpleChat.retranslated.connect(ChannelsList.retranslate),SimpleChat.online.connect(ChannelsList.online)),"undefined"==typeof ChannelsView?ChannelsView={join:function(){},create:function(){},toUrl:function(){return"#"}}:(ChannelsView.feed.connect(ChannelsList.feed.read),ChannelsView.serverRenamed.connect(ChannelsList.setName));